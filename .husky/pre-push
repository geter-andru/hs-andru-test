#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "🚀 Running pre-push validation..."

# Check 1: No console.log statements (except in server files)
if grep -r "console\.log" app/ lib/ --include="*.tsx" --include="*.ts" --exclude-dir="api" 2>/dev/null | grep -v "// @production-approved"; then
  echo "❌ console.log statements found in client code! Remove them before pushing."
  exit 1
fi

# Check 2: No TODO comments without issue numbers
if grep -r "TODO" app/ lib/ --include="*.tsx" --include="*.ts" 2>/dev/null | grep -v "TODO-[0-9]"; then
  echo "❌ TODO comments without issue numbers found! Add issue tracking."
  exit 1
fi

# Check 3: Full validation suite
echo "Running full validation suite..."
if ! npm run validate:all; then
  echo "❌ Validation failed! Fix all issues before pushing."
  exit 1
fi

# Check 4: Build test
echo "Testing production build..."
if ! npm run build; then
  echo "❌ Build failed! Fix build errors before pushing."
  exit 1
fi

echo "✅ All pre-push checks passed!"